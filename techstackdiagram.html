<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TECH STACK DIAGRAM</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <h1>Sergio Ivorra Puig AND Mario Tomas Agullo</h1>
    <div id="graph"></div>
    <div id="details" class="details-panel">
      <a href="https://www.youtube.com/@shopify-espa%C3%B1a">Youtube</a>
      <a href="https://www.instagram.com/dev_shopifying/">Instagram</a>
      <div id="details-content"></div>
    </div>
  </div>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script type="module" src="graph.js"></script>
</body>
</html>

<script>
  const data = {
    nodes: [
      { id: "ecommerce", name: "E-commerce Platform", category: "core", description: "Central platform handling online sales, product management, and basic customer interactions", icon: "https://www.shakersworks.com/hubfs/shopify.svg" },
      { id: "customer_portal", name: "Customer Portal", category: "customer", description: "Self-service portal for account management and order tracking", icon: "👤" },
      { id: "mobile_app", name: "Mobile App", category: "customer", description: "Native mobile application for shopping on-the-go", icon: "📱" },
      { id: "loyalty", name: "Loyalty Program", category: "customer", description: "Points and rewards management system", icon: "⭐" },
      { id: "erp", name: "ERP System", category: "backend", description: "Enterprise Resource Planning system for business operations, including inventory management", icon: "🏢" },
      { id: "crm", name: "CRM", category: "backend", description: "Customer Relationship Management system", icon: "📊" },
      { id: "analytics", name: "Analytics Platform", category: "backend", description: "Business intelligence and reporting tools", icon: "📈" },
      { id: "order_requests", name: "Order Requests", category: "customer", description: "Customer order submissions and requirements", icon: "📝" },
      { id: "support_tickets", name: "Support Tickets", category: "customer", description: "Customer support and assistance requests", icon: "🎫" },
      { id: "factories", name: "Factories", category: "factory", description: "Manufacturing and production facilities", icon: "🏭" }
    ],
    links: [
      { source: "customer_portal", target: "ecommerce" },
      { source: "mobile_app", target: "ecommerce" },
      { source: "loyalty", target: "ecommerce" },
      { source: "ecommerce", target: "erp" },
      { source: "ecommerce", target: "crm" },
      { source: "crm", target: "analytics" },
      { source: "erp", target: "analytics" },
      { source: "loyalty", target: "customer_portal" },
      { source: "order_requests", target: "mobile_app" },
      { source: "order_requests", target: "ecommerce" },
      { source: "ecommerce", target: "erp" },
      { source: "erp", target: "factories" }
    ]
  };

  function createGraph() {
    const width = document.getElementById('graph').clientWidth;
    const height = document.getElementById('graph').clientHeight;

    const svg = d3.select("#graph")
      .append("svg")
      .attr("width", width)
      .attr("height", height);

    const simulation = d3.forceSimulation(data.nodes)
      .force("link", d3.forceLink(data.links).id(d => d.id).distance(150))
      .force("charge", d3.forceManyBody().strength(-1000))
      .force("center", d3.forceCenter(width / 2, height / 2))
      .force("x", d3.forceX(width / 2).strength(0.1))
      .force("y", d3.forceY(height / 2).strength(0.1));

    const links = svg.append("g")
      .selectAll("line")
      .data(data.links)
      .join("line")
      .attr("class", "link connection-line");

    const nodes = svg.append("g")
      .selectAll("g")
      .data(data.nodes)
      .join("g")
      .attr("class", "node")
      .on("click", (event, d) => showDetails(event, d));

      nodes.append("svg:image")
      .attr("xlink:href", d => (d.id === "ecommerce" ? d.icon : null))
      .attr("x", d => (d.id === "ecommerce" ? -25 : -15))
      .attr("y", d => (d.id === "ecommerce" ? -25 : -15))
      .attr("width", d => (d.id === "ecommerce" ? 60 : 50))
      .attr("height", d => (d.id === "ecommerce" ? 60 : 50));


    nodes.append("text")
      .attr("class", "node-icon")
      .attr("text-anchor", "middle")
      .attr("dy", 7)
      .text(d => (d.id !== "ecommerce" ? d.icon : ""));

    nodes.append("text")
      .text(d => d.name)
      .attr("text-anchor", "middle")
      .attr("dy", 50)
      .style("font-size", "12px");

    simulation.on("tick", () => {
      links
        .attr("x1", d => d.source.x)
        .attr("y1", d => d.source.y)
        .attr("x2", d => d.target.x)
        .attr("y2", d => d.target.y);

      nodes
        .attr("transform", d => `translate(${d.x},${d.y})`);
    });

    nodes.call(d3.drag()
      .on("start", dragstarted)
      .on("drag", dragged)
      .on("end", dragended));

    function dragstarted(event) {
      if (!event.active) simulation.alphaTarget(0.3).restart();
      event.subject.fx = event.subject.x;
      event.subject.fy = event.subject.y;
    }

    function dragged(event) {
      event.subject.fx = event.x;
      event.subject.fy = event.y;
    }

    function dragended(event) {
      if (!event.active) simulation.alphaTarget(0);
      event.subject.fx = null;
      event.subject.fy = null;
    }
  }

  function showDetails(event, d) {
    const detailsContent = document.getElementById('details-content');
    detailsContent.innerHTML = `
      <h3>${d.icon} ${d.name}</h3>
      <p>${d.description}</p>
      <p><strong>Category:</strong> ${d.category.charAt(0).toUpperCase() + d.category.slice(1)}</p>
    `;
  }

  window.addEventListener('load', createGraph);
</script>

<style>
  body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    background: #2c1f4a;
    color: white;
  }
  
  .container {
    padding: 20px;
    max-width: 1400px;
    margin: 0 auto;
  }
  
  h1 {
    text-align: center;
    color: white;
  }
  
  #graph {
    background: #382a5a;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    height: 700px;
    position: relative;
  }
  
  .node {
    cursor: pointer;
    transition: all 0.3s;
  }
  
  .node:hover {
    filter: brightness(1.2);
  }
  
  .node circle {
    filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.3));
  }
  
  .node text {
    fill: white !important;
    filter: drop-shadow(0 0 2px rgba(0, 0, 0, 0.5));
  }
  
  .link {
    stroke: rgba(255, 255, 255, 0.3);
    stroke-opacity: 0.6;
    stroke-width: 2px;
  }
  
  .details-panel {
    display:none;
    position: fixed;
    right: 20px;
    top: 20px;
    width: 300px;
    background: #382a5a;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    color: white;
  }
  
  .details-panel h2, .details-panel h3 {
    margin-top: 0;
    color: white;
  }
  
  .category-customer { fill: #4a90e2; }
  .category-core { fill: #e74c3c; }
  .category-backend { fill: #2ecc71; }
  .category-request { fill: #f39c12; }
  .category-factory { fill: #9b59b6; }
  
  .connection-line {
    stroke-dasharray: 5;
    animation: dash 20s linear infinite;
  }
  
  .node-icon {
    fill: white;
    font-size: 20px;
  }
  
  @keyframes dash {
    to {
      stroke-dashoffset: 1000;
    }
  }

</style>

